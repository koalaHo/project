"use strict";var login=getCookie("login");function renderCar(n){var o,t,e;n.length&&login?(o=n.every(function(n){return 1==n.is_select}),t=shopNum(n),e='<section class="content1">\n        <h5 class="carTitle">我的购物车 <span>共 <i>'+shopSum(n)+'</i> 件</span></h5>\n        <div class="goods">\n            <div class="cheAll"><input type="checkbox" name="" class="all" '+(o?"checked":"")+"> 全选</div>",n.forEach(function(n){e+='<div class="googsList">\n            <div class="list">\n                <div class="itemLeft">\n                    <p class="checkList"><input type="checkbox" class="check" name="" '+(1==n.is_select?"checked":"")+' goods_id="'+n.goods_id+'"></p>\n                    <p class="smallPic"><img src="'+n.img+'" alt=""></p>\n                    <div class="goodsText">\n                        <h4>'+n.name+'</h4>\n                        <p>尺码:M</p>\n                        <div class="goodsNum" goods_id="'+n.goods_id+'">\n                            <i>数量：</i><span class="reduce">-</span><input type="text" name="" class="goodNum" value="'+n.cart_number+'"><span class="add">+</span>\n                        </div>\n                    </div>\n                </div>\n                <div class="itemRight">\n                    <h5>￥ <span>'+n.prise+"</span></h5>\n                    <del>￥ "+n.prise+'</del>\n                    // <p class="del" goods_id="'+n.goods_id+'">删除</p>\n                </div>\n            </div>\n        </div>'}),e+='</div>\n        </section>\n        <div class="contentFoolter">\n            <div class="checkAll">\n                <input type="checkbox" name="" class="all" '+(o?"checked":"")+'> 全选商品 <span class="delSome">删除商品</span>\n            </div>\n            <ul>\n                <li class="sum">\n                    <h5>总价</h5>\n                    <p>￥ <span>'+t.totalPrice+'</span></p>\n                </li>\n                <li class="close">结 算</li>\n            </ul>\n        </div>',$(".content").html(e)):$(".content").html('        <section class="content1">\n        <h5 class="carTitle">我的购物车 <span>共 <i>0</i> 件</span></h5>\n        <div class="goods">\n            <div class="goodsNone">\n                <h2 class="hint3"><img src="../img/car_pic_03.jpg" alt=""></h2>\n                <h3 class="hint4">您的购物车中没有任何商品，马上去\n                    <a href="../index1.html">挑选商品</a>\n                </h3>\n            </div>\n        </div>\n    </section>\n    <div class="contentFoolter">\n        <div class="checkAll">\n            <input type="checkbox" name="" id=""> 全选商品 <span>删除商品</span>\n        </div>\n        <ul>\n            <li class="sum">\n                <h5>总价</h5>\n                <p>￥ <span>0.00</span></p>\n            </li>\n            <li class="close">结 算</li>\n        </ul>\n    </div>')}function shopNum(n){n=n.filter(function(n){return 1==n.is_select});return{totalNum:n.reduce(function(n,o){return n+ +o.cart_number},0),totalPrice:n.reduce(function(n,o){return n+o.prise*o.cart_number},0)}}function shopSum(n){return n.reduce(function(n,o){return n+ +o.cart_number},0)}login&&$(".log").html("欢迎你，"+login+' <i class="off">注销</i>'),$(".off").on("click",function(){confirm("你确定退出吗？")&&(delCookie("login"),location.reload(!0))}),login||(location.href="../html/login.html",localStorage.setItem("url","../html/car.html")),$.get("../api/getCarData.php",{username:login},function(n){localStorage.setItem("goodsList",JSON.stringify(n)),renderCar(n)},"json"),$(".content").on("click",".all",function(){var o=this,n=JSON.parse(localStorage.getItem("goodsList"));n.forEach(function(n){o.checked?n.is_select=1:n.is_select=0}),localStorage.setItem("goodsList",JSON.stringify(n)),renderCar(n)}),$(".content").on("click",".check",function(){var o=this,n=JSON.parse(localStorage.getItem("goodsList"));n.forEach(function(n){n.goods_id==$(o).attr("goods_id")&&(n.is_select=o.checked?1:0)}),localStorage.setItem("goodsList",JSON.stringify(n)),renderCar(n)}),$(".content").on("click",".del",function(){var t=$(this).attr("goods_id");$.get("../api/removeCarData.php",{username:login,goods_id:t},function(n){var o;n.code&&(n=(o=JSON.parse(localStorage.getItem("goodsList"))).filter(function(n){return n.goods_id!=t}),localStorage.setItem("goodsList",JSON.stringify(n)),renderCar(o))},"json")}),$(".content").on("click",".reduce",function(){var o=$(this).parent().attr("goods_id"),t=JSON.parse(localStorage.getItem("goodsList")),e=t.filter(function(n){return n.goods_id==o})[0],s=+e.cart_number;s<=1?s=1:s--,$.get("../api/updCarData.php",{username:login,goods_id:o,goods_num:s},function(n){console.log(n),e.cart_number=s,localStorage.setItem("goodsList",JSON.stringify(t)),renderCar(t)},"json")}),$(".content").on("click",".add",function(){var o=$(this).parent().attr("goods_id"),t=JSON.parse(localStorage.getItem("goodsList")),e=t.filter(function(n){return n.goods_id==o})[0],s=+e.cart_number;s++,$.get("../api/updCarData.php",{username:login,goods_id:o,goods_num:s},function(n){n.code&&(e.cart_number=s,localStorage.setItem("goodsList",JSON.stringify(t)),renderCar(t))},"json")}),$(".content").on("click",".goodNum",function(){$(this).change(function(){var o,t,e,s,i,n;isPositiveNum(+$(this).val())?($(document).ajaxStart(function(){console.log(1),$(".reminder").show()}).ajaxStop(function(){console.log(2),$(".reminder").hide()}),o=JSON.parse(localStorage.getItem("goodsList")),t=$(this).parent().attr("goods_id"),e=o.filter(function(n){return n.goods_id==t})[0],s=+$(this).val(),$.get("../api/updCarData.php",{username:login,goods_id:t,goods_num:s},function(n){n.code&&(e.cart_number=s,localStorage.setItem("goodsList",JSON.stringify(o)),renderCar(o))},"json")):(n=JSON.parse(localStorage.getItem("goodsList")),i=$(this).parent().attr("goods_id"),n=n.filter(function(n){return n.goods_id==i})[0],$(this).val(n.cart_number))})}),$(".content").on("click",".close",function(){var n=JSON.parse(localStorage.getItem("goodsList")),o=n.filter(function(n){return!n.is_select});n.forEach(function(n){1==n.is_select&&$.get("../api/removeCarData.php",{username:login,goods_id:n.goods_id},function(n){(n=JSON.parse(n)).code&&(localStorage.setItem("goodsList",JSON.stringify(o)),renderCar(o))})},"json")}),$(".content").on("click",".delSome",function(){var n=JSON.parse(localStorage.getItem("goodsList")),o=n.filter(function(n){return!n.is_select});n.forEach(function(n){1==n.is_select&&$.get("../api/removeCarData.php",{username:login,goods_id:n.goods_id},function(n){(n=JSON.parse(n)).code&&(localStorage.setItem("goodsList",JSON.stringify(o)),renderCar(o))})},"json")});